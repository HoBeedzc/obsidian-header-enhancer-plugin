<h1 align="center">Obsidian Header Enhancer｜Obsidian 标题增强插件</h1>
<div align="center">

[[中文](./README.zh.md)] [[English](./README.md)]

</div>

一个功能强大的 Obsidian 插件，为您的 Markdown 标题提供自动编号、智能反向链接管理和可自定义的格式选项。

**当前版本**: 0.4.0

## ✨ 核心特性

### 🔢 智能标题自动编号
自动为您的标题添加层次化编号（1.1、1.2、2.1 等），具备智能检测和实时更新功能。

**主要功能：**
- **全局与文档级别控制**：整个知识库的主开关加上单文档控制
- **自动标题级别检测**：智能检测文档中的标题级别
- **实时更新**：在标题行按 `Enter` 键时自动更新编号
- **层次化结构**：支持嵌套编号（1.1.1、1.1.2、1.2.1 等）
- **可自定义分隔符**：支持 `.`、`-`、`/` 或 `,` 作为分隔符
- **灵活的起始级别**：可配置从哪个标题级别（H1-H6）开始编号
- **单文件控制**：使用 YAML 前置元数据覆盖全局设置
- **批量操作**：通过确认对话框对整个知识库应用或移除编号

![header-auto-numbering-example](./doc/img/header-auto-numbering-example.gif)

### 🔗 智能反向链接管理
当标题编号发生变化时自动维护反向链接，确保您的维基式链接保持连接。

**功能特点：**
- **自动链接更新**：标题编号时自动更新 `[[文件名#标题]]` 链接
- **批量处理**：高效处理整个知识库中的多个链接更新
- **双向更新**：添加和移除标题编号时都能正确工作
- **安全操作**：具备错误处理和通知的链接完整性保护

### 🎨 高级字体自定义
精细调整标题和文档标题的视觉外观，提供全面的字体选项。

**功能特色：**
- **独立标题字体**：为 Markdown 标题（#、##、### 等）自定义字体系列和大小
- **独立文档标题字体**：专门为文档标题自定义字体系列和大小
- **分类字体选项**：提供包括衬线、无衬线、等宽字体等分类的字体选择
- **实时预览**：在设置面板中实时预览字体更改
- **继承支持**：使用"inherit"保持 Obsidian 的默认样式
- **独立控制**：标题字体和文档标题字体可以分别自定义

### 📝 增强的 YAML 配置支持
使用改进的 YAML 前置元数据架构对单个文件进行精细的标题编号控制。

**配置示例：**
```yaml
---
header-auto-numbering: ["state on", "first-level h2", "max 1", "start-at 1", "separator ."]
---
```

**新功能特性：**
- **更新的架构**：更直观的参数命名和结构
- **更好的验证**：改进的错误处理和用户反馈
- **智能默认值**：基于全局设置的智能默认值

### 🎯 高级编辑器集成
使用 CodeMirror 6 扩展与 Obsidian 编辑器无缝集成。

**功能特色：**
- **智能按键处理**：为标题提供自定义的 `Enter` 和 `Backspace` 行为
- **高优先级处理**：确保与其他插件的兼容性
- **实时处理**：输入时即时反馈和更新
- **批量操作对话框**：带进度跟踪的知识库范围操作确认对话框

## 🚀 安装方法

### 从 Obsidian 社区插件【推荐】
1. 打开 **设置** → **社区插件**
2. 关闭 **安全模式**
3. 点击 **浏览** 社区插件
4. 搜索 "**Header Enhancer**"
5. 点击 **安装**
6. 在已安装插件列表中启用该插件

### 手动安装
1. 下载 [最新发布版本](https://github.com/HoBeedzc/obsidian-header-enhancer-plugin/releases/latest)
2. 将 ZIP 文件解压到 `<库目录>/.obsidian/plugins/header-enhancer/`
3. 确保 `main.js`、`manifest.json` 和 `styles.css` 在插件文件夹中
4. 重新加载 Obsidian 或在设置中启用插件

## ⚙️ 配置与使用

### 基本设置
插件提供 **双级控制** 的自动编号管理：

#### 全局控制
- **主开关**：启用/禁用整个知识库的自动编号功能
- **设置访问**：启用后配置全局默认值
- **状态显示**：在状态栏和功能区显示当前全局状态

#### 文档控制
- **单文档切换**：为单个文档启用/禁用编号（当全局启用时）
- **功能区按钮**：点击标题图标切换当前文档的编号状态
- **命令访问**：使用 `Ctrl/Cmd+P` → "Header Enhancer: Toggle Document Auto Numbering"
- **状态栏显示**：在底部状态栏查看当前文档状态（如果已启用）

### 全局设置

#### 编号配置
- **启用自动编号功能**：启用/禁用整个自动编号功能的主开关
- **自动标题级别检测**：自动检测并使用文档中存在的标题级别
- **起始级别**：选择从哪个标题级别（H1-H6）开始编号（当自动检测关闭时）
- **结束级别**：选择在哪个标题级别（H1-H6）停止编号（当自动检测关闭时）
- **分隔符**：从 `.`、`-`、`/` 或 `,` 中选择（默认：`.`）
- **起始数字**：设置初始编号（默认：`1`）
- **标题分隔符**：编号与标题文本之间的字符（默认：制表符 `\t`）
- **格式预览**：自定义设置时的编号格式实时预览

#### 字体自定义
- **标题字体**：为 Markdown 标题单独设置字体系列和大小
- **文档标题字体**：为文档标题单独设置字体系列和大小
- **字体分类**：包括衬线、无衬线、等宽、系统和热门字体的分类选项
- **实时预览**：在设置面板中实时预览字体效果
- **继承选项**：可选择继承 Obsidian 的默认样式

#### 反向链接管理
- **更新反向链接**：标题变化时自动更新 `[[文件名#标题]]` 链接
- **安全更新**：批量处理，具备错误处理和回滚功能

#### 界面选项
- **显示状态栏**：在底部栏显示自动编号状态
- **显示在侧边栏**：切换左侧功能区的图标显示
- **语言**：支持英文和中文

### 单文件 YAML 控制

使用前置元数据为单个文件覆盖全局设置：

```yaml
---
header-auto-numbering: ["state on", "first-level h2", "max 1", "start-at 1", "separator ."]
---
```

**YAML 参数：**
- `state on/off`：启用/禁用该文件的编号
- `first-level h1-h6`：起始标题级别
- `max N`：最大嵌套深度
- `start-at N`：起始编号
- `separator X`：分隔符字符

### 可用命令

| 命令 | 描述 |
|------|------|
| **切换全局自动编号** | 开启/关闭整个知识库的标题编号功能 |
| **切换文档自动编号** | 仅为当前文档开启/关闭标题编号 |
| **批量应用编号** | 为知识库中所有文件添加编号（带确认对话框） |
| **批量移除编号** | 从知识库中所有文件移除编号（带确认对话框） |
| **添加自动编号 YAML** | 为当前文件添加 YAML 配置 |
| **重置自动编号 YAML** | 重置 YAML 为默认值 |
| **移除自动编号 YAML** | 移除 YAML 配置 |

## 💡 使用技巧

### 标题编号最佳实践
1. **双级控制**：使用全局开关启用/禁用整个功能，使用文档切换控制单个文件
2. **自动检测**：启用"自动标题级别检测"实现智能标题级别管理
3. **保持层次结构**：维持逻辑的标题层次（H1 → H2 → H3）
4. **YAML 覆盖**：为特殊文档使用单文件 YAML（无编号、不同起始级别）
5. **分隔符选择**：选择不会与内容冲突的分隔符
6. **备份优先**：批量操作前务必备份知识库
7. **合理使用批量操作**：充分利用带确认对话框的批量应用/移除功能处理大型知识库

### 反向链接管理
- 添加/移除标题编号时自动更新链接
- 支持标准的 Obsidian `[[文件名#标题]]` 语法
- 处理包含特殊字符的复杂标题文本
- 保留链接上下文和格式

### 键盘快捷键
- **标题行按 Enter**：自动为新标题添加/更新编号（当启用时）
- **标题行按 Backspace**：智能删除处理（保留结构）
- **功能区点击**：切换当前文档的编号状态（当全局启用时）
- **命令面板**：访问全局和文档级别的切换命令

## 🔧 技术细节

### 架构
- **CodeMirror 6 集成**：高优先级按键处理，无缝编辑体验
- **实时处理**：即时更新，不影响性能
- **安全文件操作**：原子更新，具备回滚功能
- **国际化支持**：完整的 i18n 支持和回退系统

### 兼容性
- **Obsidian 版本**：需要 0.16.0+
- **平台支持**：桌面端和移动端
- **插件兼容性**：高优先级按键映射，防止冲突
- **导出兼容性**：编号后的标题在外部 Markdown 编辑器中可用

## 🐛 已知问题与故障排除

### 当前限制
- **需要手动刷新**：手动更改标题级别时，编号可能不会立即更新。将光标移至标题行并按 `Enter` 键刷新
- **制表符分隔符**：默认分隔符使用制表符（`\t`）。如果标题包含制表符，编号可能无法正常工作
- **标题中的空格**：使用空格作为分隔符时，确保标题不包含前导/尾随空格

### 常见问题与解决方案

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 编号未更新 | 手动更改了标题级别 | 在标题行按 `Enter` 键刷新 |
| 编号后反向链接失效 | 未自动更新链接 | 检查"更新反向链接"设置是否启用 |
| 插件冲突 | 按键处理冲突 | Header Enhancer 使用最高优先级 - 请通过 GitHub 报告冲突 |
| YAML 不生效 | YAML 格式不正确 | 使用"添加自动编号 yaml"命令获取正确格式 |

### 问题报告
发现了 Bug？请在 [GitHub Issues](https://github.com/HoBeedzc/obsidian-header-enhancer-plugin/issues) 报告，并包含：
- Obsidian 版本
- 插件版本
- 重现步骤
- 预期行为 vs 实际行为

## 🗺️ 开发路线图

### 已完成功能
- ✅ **标题自动编号** - 智能层次化编号系统
- ✅ **YAML 配置** - 单文件设置覆盖
- ✅ **反向链接管理** - 自动链接更新（v0.2.0）
- ✅ **自定义字体** - 独立标题和文档标题字体自定义（v0.3.0）
- ✅ **实时设置预览** - 实时格式和字体预览（v0.3.0）
- ✅ **增强UI控制** - 改进的设置界面和侧边栏切换（v0.3.0）
- ✅ **全局与文档控制** - 双级自动编号控制（v0.4.0）
- ✅ **自动标题级别检测** - 智能标题级别检测（v0.4.0）
- ✅ **国际化支持** - 英文和中文支持
- ✅ **状态栏集成** - 实时状态显示
- ✅ **CodeMirror 6 集成** - 现代编辑器兼容性

### 即将推出的功能
- 📱 **移动端优化** - 增强移动端体验
- 🔍 **搜索集成** - 标题搜索和导航
- 🎯 **快速操作** - 标题操作快捷键
- 🎨 **高级样式** - 更多字体选项和主题

## 📊 更新日志

### 版本 0.4.0（当前）
- ✨ **新增**：全局与文档级别控制 - 整个知识库的主开关加上单文档控制
- ✨ **新增**：自动标题级别检测 - 智能检测文档中的标题级别
- ✨ **新增**：增强的国际化支持和改进的翻译
- ✨ **新增**：全局和文档级别自动编号控制的独立命令
- ✨ **新增**：显示当前自动编号状态的视觉状态指示器
- 🔧 **改进**：设置界面新增全局启用/禁用开关和依赖选项
- 🔧 **改进**：状态栏和功能区图标反映当前编号状态
- 🔧 **改进**：更好的用户体验，清楚区分全局和文档控制
- 🔧 **改进**：不同操作上下文的增强通知消息
- 🐛 **修复**：命令组织优化，移除遗留切换命令以避免混淆

### 版本 0.3.3
- ✨ **新增**：带确认和进度跟踪的批量操作对话框
- ✨ **新增**：自动编号激活对话框，提供知识库范围应用选项
- ✨ **新增**：自动编号移除确认对话框，提供批量移除选项
- ✨ **新增**：增强的 YAML 架构，提供更好的验证和用户指导
- ✨ **新增**：扩展的字体系列分类，提供有组织的字体选择
- ✨ **新增**：长时间操作的进度指示器
- 🔧 **改进**：提取和模块化编辑器处理程序和CSS样式管理
- 🔧 **改进**：更好的批量操作错误处理和用户反馈
- 🔧 **改进**：增强的对话框UI，提供警告和手动操作提示
- 🐛 **修复**：批量处理和编辑器冲突防护的各种边界情况

### 版本 0.3.0
- ✨ **新增**：自定义字体系统，支持独立的标题和文档标题字体控制
- ✨ **新增**：设置中编号格式和字体更改的实时预览
- ✨ **新增**：侧边栏切换选项，可显示/隐藏功能区图标
- ✨ **新增**：增强的设置界面，改进的验证和国际化支持
- 🔧 **改进**：将"最大标题级别"重命名为"结束标题级别"以提高清晰度
- 🔧 **改进**：设置中的YAML控制和禁用状态预览
- 🔧 **改进**：更好的设置组织和用户体验
- 🐛 **修复**：各种UI一致性问题和边界情况

### 版本 0.2.0
- ✨ **新增**：智能反向链接管理系统
- ✨ **新增**：自动 `[[文件名#标题]]` 链接更新
- ✨ **新增**：批量链接处理和错误恢复机制
- ✨ **新增**：双向链接更新（添加和移除编号时）
- 🔧 **改进**：增强的标题文本提取和解析
- 🔧 **改进**：更好的错误处理和用户通知
- 🐛 **修复**：标题编号逻辑中的多个边界情况

### 历史版本
完整更新日志请查看 [doc/changelog.md](./doc/changelog.md)

## 🙏 致谢与贡献

本插件基于 Obsidian 社区的优秀工作构建：

- **[easy-typing-obsidian](https://github.com/Yaozhuwa/easy-typing-obsidian)** - 编辑器集成模式
- **[obsidian-state-switcher](https://github.com/lijyze/obsidian-state-switcher)** - 状态管理灵感
- **[number-headings-obsidian](https://github.com/onlyafly/number-headings-obsidian)** - 初始编号概念
- **Obsidian 社区** - 反馈、测试和功能建议

## 💖 支持与贡献

### 表达支持
如果这个插件改善了您的笔记工作流程：

<a href="https://bmc.link/hobee">
  <img src="https://img.buymeacoffee.com/button-api/?text=请我喝杯咖啡&emoji=&slug=hobee&button_colour=FFDD00&font_colour=000000&font_family=Cookie&outline_colour=000000&coffee_colour=ffffff" />
</a>

### 贡献代码
欢迎贡献！请：
1. Fork 仓库
2. 创建功能分支
3. 提交详细说明的 Pull Request
4. 遵循现有的代码风格和模式

### 开发环境设置
```bash
# 克隆和设置
git clone https://github.com/HoBeedzc/obsidian-header-enhancer-plugin.git
cd obsidian-header-enhancer-plugin
npm install

# 开发模式（监听并重新构建）
npm run dev

# 生产构建
npm run build

# 版本升级
npm run version
```

---

<div align="center">

**由 [Hobee Liu](https://github.com/HoBeedzc) 用 ❤️ 制作**

⭐ **如果觉得有用请给个星标！** ⭐

</div>
